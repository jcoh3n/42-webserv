<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualiseur CSS - 42 Webserv</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1 {
            color: #00babc;
            font-size: 2.5rem;
            font-weight: 800;
            margin-top: 1rem;
            background: linear-gradient(135deg, #00babc 0%, #6200ea 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
        }
        .css-container {
            background-color: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 188, 188, 0.1);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        .decoration {
            position: absolute;
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(0, 186, 188, 0.1) 0%, rgba(98, 0, 234, 0.1) 100%);
            z-index: 0;
        }
        .decoration-1 {
            top: -75px;
            right: -75px;
        }
        .decoration-2 {
            bottom: -75px;
            left: -75px;
        }
        .css-container > * {
            position: relative;
            z-index: 1;
        }
        #css-code {
            background-color: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            overflow: auto;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
            line-height: 1.5;
            margin-top: 20px;
            max-height: 500px;
        }
        .css-selector {
            color: #e36209;
        }
        .css-property {
            color: #005cc5;
        }
        .css-value {
            color: #0366d6;
        }
        .css-comment {
            color: #6a737d;
            font-style: italic;
        }
        .css-unit {
            color: #d73a49;
        }
        .css-color {
            position: relative;
            padding-left: 18px;
        }
        .css-color-preview {
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #00babc;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }
        .back-link:hover {
            transform: translateX(-5px);
        }
        .back-link::before {
            content: "‚Üê";
            margin-right: 8px;
            font-size: 1.2rem;
        }
        .control-panel {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .action-button {
            background: linear-gradient(135deg, #00babc 0%, #008f91 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 186, 188, 0.15);
            margin: 5px;
        }
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 186, 188, 0.25);
        }
        .css-info {
            display: flex;
            justify-content: space-between;
            background-color: #e3fcef;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            color: #00875a;
            font-weight: 500;
        }
        .css-info-item {
            display: flex;
            align-items: center;
        }
        .css-info-icon {
            margin-right: 8px;
            font-size: 1.2rem;
        }
        .css-preview {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            background-color: #fff;
            border: 1px dashed #00babc;
            position: relative;
        }
        .css-preview-label {
            position: absolute;
            top: -10px;
            left: 15px;
            background: white;
            padding: 0 10px;
            color: #00babc;
            font-weight: 600;
            font-size: 14px;
        }
        .css-preview-toggle {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-top: 10px;
        }
        .css-preview-toggle input {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <a href="/" class="back-link">Retour √† l'accueil</a>
    
    <h1>Visualiseur CSS</h1>
    
    <div class="css-container">
        <div class="decoration decoration-1"></div>
        <div class="decoration decoration-2"></div>

        <div class="control-panel">
            <div>
                <button id="format-css" class="action-button">Formater le CSS</button>
                <button id="analyze-css" class="action-button">Analyser la structure</button>
            </div>
            <div>
                <button id="raw-css" class="action-button">Voir CSS brut</button>
            </div>
        </div>
        
        <div id="css-code">Chargement...</div>
        
        <div class="css-preview-toggle">
            <input type="checkbox" id="toggle-preview" checked>
            <label for="toggle-preview">Afficher la pr√©visualisation</label>
        </div>
        
        <div class="css-preview" id="css-preview-container">
            <div class="css-preview-label">Pr√©visualisation</div>
            <div id="css-preview-content">
                <div id="preview-element">Exemple de texte stylis√©</div>
            </div>
        </div>
        
        <div class="css-info">
            <div class="css-info-item">
                <div class="css-info-icon">üìä</div>
                <span>Taille: <span id="css-size">-</span></span>
            </div>
            <div class="css-info-item">
                <div class="css-info-icon">üìù</div>
                <span>Type: <span id="css-content-type">-</span></span>
            </div>
            <div class="css-info-item">
                <div class="css-info-icon">üîÑ</div>
                <span>ETag: <span id="css-etag">-</span></span>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Fonctions utilitaires
            function formatSize(bytes) {
                const units = ['B', 'KB', 'MB', 'GB'];
                let size = bytes;
                let unitIndex = 0;
                
                while (size >= 1024 && unitIndex < units.length - 1) {
                    size /= 1024;
                    unitIndex++;
                }
                
                return `${size.toFixed(unitIndex === 0 ? 0 : 2)} ${units[unitIndex]}`;
            }
            
            // Fonction pour formater le CSS
            function formatCSS(css) {
                // Suppression des espaces et des tabulations inutiles
                css = css.replace(/\s+/g, ' ');
                // Suppression des espaces avant et apr√®s les accolades
                css = css.replace(/\s*{\s*/g, ' {\n    ');
                css = css.replace(/\s*}\s*/g, '\n}\n\n');
                // Formatage des propri√©t√©s
                css = css.replace(/;\s*/g, ';\n    ');
                css = css.replace(/\n    \}/g, '\n}');
                
                return css;
            }
            
            // Fonction pour coloriser le CSS
            function highlightCSS(code) {
                let result = code;
                
                // Coloration des s√©lecteurs
                result = result.replace(/(.*?)(?={)/g, '<span class="css-selector">$1</span>');
                
                // Coloration des propri√©t√©s et des valeurs
                result = result.replace(/([\w-]+)(\s*:\s*)([^;]+)(;?)/g, function(match, prop, colon, value, semicolon) {
                    let coloredValue = value;
                    
                    // D√©tection et coloration des couleurs
                    coloredValue = coloredValue.replace(/(#[0-9a-f]{3,8}|rgba?\([^)]+\)|hsla?\([^)]+\))/gi, function(colorValue) {
                        return `<span class="css-color"><span class="css-color-preview" style="background-color:${colorValue}"></span>${colorValue}</span>`;
                    });
                    
                    // Coloration des unit√©s
                    coloredValue = coloredValue.replace(/(-?\d+\.?\d*)([a-z%]+)/g, '$1<span class="css-unit">$2</span>');
                    
                    return `<span class="css-property">${prop}</span>${colon}<span class="css-value">${coloredValue}</span>${semicolon}`;
                });
                
                // Coloration des commentaires
                result = result.replace(/\/\*[\s\S]*?\*\//g, '<span class="css-comment">$&</span>');
                
                // Conserver le formatage
                result = result.replace(/\n/g, '<br>');
                result = result.replace(/    /g, '&nbsp;&nbsp;&nbsp;&nbsp;');
                
                return result;
            }
            
            // Chargement du CSS
            try {
                const response = await fetch('/test.css');
                const contentType = response.headers.get('Content-Type');
                const etag = response.headers.get('ETag');
                const cssText = await response.text();
                
                // Mise √† jour des infos
                document.getElementById('css-content-type').textContent = contentType || 'text/css';
                document.getElementById('css-etag').textContent = etag || 'Non disponible';
                document.getElementById('css-size').textContent = formatSize(cssText.length);
                
                // Affichage du CSS format√© et coloris√©
                const formattedCSS = formatCSS(cssText);
                document.getElementById('css-code').innerHTML = highlightCSS(formattedCSS);
                
                // Pr√©visualisation CSS
                const styleElement = document.createElement('style');
                styleElement.textContent = cssText;
                document.head.appendChild(styleElement);
                
                // Gestion des boutons
                document.getElementById('format-css').addEventListener('click', () => {
                    document.getElementById('css-code').innerHTML = highlightCSS(formatCSS(cssText));
                });
                
                document.getElementById('raw-css').addEventListener('click', () => {
                    const win = window.open('', '_blank');
                    win.document.write('<pre>' + cssText + '</pre>');
                    win.document.title = 'CSS brut - 42 Webserv';
                });
                
                document.getElementById('analyze-css').addEventListener('click', () => {
                    // Analyse simple des r√®gles CSS
                    const selectors = cssText.match(/[^\{\}]+(?=\{)/g) || [];
                    const properties = cssText.match(/[^\{\};]+(?=;)/g) || [];
                    
                    const analysis = `
                        <div style="padding: 15px; background: #f0f8ff; border-radius: 8px; margin-top: 15px;">
                            <h3 style="margin-top: 0;">Analyse CSS</h3>
                            <ul>
                                <li>Nombre de s√©lecteurs: ${selectors.length}</li>
                                <li>Nombre de propri√©t√©s: ${properties.length}</li>
                                <li>Taille du fichier: ${formatSize(cssText.length)}</li>
                            </ul>
                            <h4>Principaux s√©lecteurs:</h4>
                            <ul>
                                ${selectors.slice(0, 5).map(s => `<li>${s.trim()}</li>`).join('')}
                                ${selectors.length > 5 ? `<li>... et ${selectors.length - 5} autres</li>` : ''}
                            </ul>
                        </div>
                    `;
                    
                    document.getElementById('css-preview-content').innerHTML = analysis;
                });
                
                // Toggle pr√©visualisation
                document.getElementById('toggle-preview').addEventListener('change', (e) => {
                    document.getElementById('css-preview-container').style.display = e.target.checked ? 'block' : 'none';
                });
            } catch (error) {
                document.getElementById('css-code').innerHTML = `<div style="color: #de350b;">Erreur: ${error.message}</div>`;
            }
        });
    </script>
</body>
</html> 